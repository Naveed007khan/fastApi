name: Python application

on:
  push:
    branches: ["main"]
  
permissions:
  contents: read
  
jobs:
  build:
    runs-on: self-hosted
    steps:
    - name: check out the code
      uses: actions/checkout@v4
      
    - name: setup python 
      run: | 
        
        cd $GITHUB_WORKSPACE
        sudo docker build -t myapp .
        sudo docker images
        if [ "$(sudo docker ps  -aq -f name=my-app-container)" ]; then
            sudo docker rm -f my-app-container
        fi
        sudo docker run -p 8000:8000 --name my-app-container -d myapp
        sudo docker ps 
    - name: message
      run: | 
        echo "application deployed"
    - name: Teams Notification (Unified)
      if: always()
      uses: jdcargile/ms-teams-notification@v1.4
      with:
       github-token: ${{ github.token }}
       ms-teams-webhook-uri: ${{ secrets.MS_TEAMS_WEBHOOK_URI }}
       notification-summary: |
         ${{ job.status == 'success' && '‚úÖ **Deployment Successful** üéâ' || 'üö® **DEPLOYMENT FAILED ‚Äì ACTION REQUIRED**' }}

          Project: ${{ github.repository }}
          Status: ${{ job.status }}
          Branch: ${{ github.ref_name }}
          Triggered By: ${{ github.actor }}
          Commit: ${{ github.sha }}
          Time: ${{ github.event.head_commit.timestamp }}
          ${{ job.status == 'success' && 'üéØ Application has been successfully deployed and is running.' || '‚ö†Ô∏è Pipeline failed. Please check logs immediately.' }}
          Logs: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          notification-color: ${{ job.status == 'success' && '28a745' || 'dc3545' }}
          timezone: Asia/Karachi
          verbose-logging: true

